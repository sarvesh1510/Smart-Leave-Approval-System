{% extends "base.html" %}
{% block title %}Change Password | Smart Leave Assistant{% endblock %}

{% block content %}
<div class="min-h-[70vh] flex items-center justify-center">
  <div class="w-full max-w-md glass p-6 rounded-lg" data-aos="fade-up">
    <h2 class="text-2xl font-semibold text-white mb-2">Change Password</h2>
    <p class="text-slate-400 text-sm mb-4">Keep your account secure by updating your password regularly.</p>

    <form method="POST" action="{{ url_for('change_password') }}" class="space-y-4" id="passwordForm">
      
      <!-- Current Password -->
      <div>
        <label class="text-sm text-slate-300">
          Current Password <span class="text-rose-500">*</span>
        </label>
        <div class="relative">
          <input type="password" name="current_password" required
            class="w-full mt-1 px-3 py-2 pr-10 bg-[rgba(255,255,255,0.02)] rounded-md text-slate-200 outline-none focus:ring-2 focus:ring-indigo-500"
            id="current_password">
          <i class="fa-solid fa-eye absolute right-3 top-3 text-slate-400 cursor-pointer hover:text-indigo-400 transition"
             onclick="togglePassword('current_password', this)"></i>
        </div>
      </div>

      <!-- New Password -->
      <div>
        <label class="text-sm text-slate-300">
          New Password <span class="text-rose-500">*</span>
        </label>
        <div class="relative">
          <input type="password" name="new_password" id="new_password" required minlength="4"
            class="w-full mt-1 px-3 py-2 pr-10 bg-[rgba(255,255,255,0.02)] rounded-md text-slate-200 outline-none focus:ring-2 focus:ring-indigo-500">
          <i class="fa-solid fa-eye absolute right-3 top-3 text-slate-400 cursor-pointer hover:text-indigo-400 transition"
             onclick="togglePassword('new_password', this)"></i>
        </div>

        <!-- Password strength bar -->
        <div class="mt-2 h-2 w-full bg-slate-800 rounded-full overflow-hidden">
          <div id="strength-bar" class="h-full w-0 transition-all duration-300 rounded-full"></div>
        </div>
        <p id="strength-text" class="text-xs text-slate-400 mt-1"></p>
      </div>

      <!-- Confirm Password -->
      <div>
        <label class="text-sm text-slate-300">
          Confirm New Password <span class="text-rose-500">*</span>
        </label>
        <div class="relative">
          <input type="password" name="confirm_password" id="confirm_password" required minlength="4"
            class="w-full mt-1 px-3 py-2 pr-10 bg-[rgba(255,255,255,0.02)] rounded-md text-slate-200 outline-none focus:ring-2 focus:ring-indigo-500">
          <i class="fa-solid fa-eye absolute right-3 top-3 text-slate-400 cursor-pointer hover:text-indigo-400 transition"
             onclick="togglePassword('confirm_password', this)"></i>
        </div>
      </div>

      <button type="submit"
        class="w-full py-2 rounded-md bg-gradient-to-r from-primary1 to-primary2 text-white font-semibold shadow-glow hover:scale-[1.02] transition">
        Update Password
      </button>

      <div class="text-center text-sm text-slate-400 mt-2">
        <a href="{{ url_for('dashboard') }}" class="text-indigo-300 underline hover:text-indigo-400 transition">‚Üê Back to Dashboard</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  //  Toggle password visibility
  function togglePassword(fieldId, icon) {
    const input = document.getElementById(fieldId);
    if (input.type === "password") {
      input.type = "text";
      icon.classList.remove("fa-eye");
      icon.classList.add("fa-eye-slash");
    } else {
      input.type = "password";
      icon.classList.remove("fa-eye-slash");
      icon.classList.add("fa-eye");
    }
  }

  //  Password strength indicator
  const newPassword = document.getElementById("new_password");
  const strengthBar = document.getElementById("strength-bar");
  const strengthText = document.getElementById("strength-text");

  newPassword.addEventListener("input", () => {
    const val = newPassword.value;
    let strength = 0;

    if (val.length >= 6) strength++;
    if (/[A-Z]/.test(val)) strength++;
    if (/[0-9]/.test(val)) strength++;
    if (/[^A-Za-z0-9]/.test(val)) strength++;

    const colors = ["#ef4444", "#f59e0b", "#10b981"];
    const texts = ["Weak", "Medium", "Strong"];
    const widths = ["25%", "60%", "100%"];

    if (val.length === 0) {
      strengthBar.style.width = "0";
      strengthText.textContent = "";
    } else {
      strengthBar.style.width = widths[strength - 1] || "25%";
      strengthBar.style.backgroundColor = colors[strength - 1] || "#ef4444";
      strengthText.textContent = texts[strength - 1] || "Weak";
      strengthText.style.color = colors[strength - 1] || "#ef4444";
    }
  });
</script>
{% endblock %}
