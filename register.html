{% extends "base.html" %}
{% block title %}Register | Smart Leave Assistant{% endblock %}

{% block content %}
<div class="min-h-[70vh] flex items-center justify-center">
  <div class="w-full max-w-2xl glass p-6 rounded-lg" data-aos="fade-up">
    <h2 class="text-2xl font-semibold text-white">Create Your Account</h2>
    <p class="text-slate-400 mt-1 mb-4">Only employees can register here.</p>

    <form method="POST" action="{{ url_for('register') }}" class="space-y-4" id="registerForm">

      <!-- Full Name -->
      <div>
        <label class="text-sm text-slate-300">
          Full Name <span class="text-rose-500">*</span>
        </label>
        <input type="text" name="name" required
          class="w-full mt-1 px-3 py-2 bg-[rgba(255,255,255,0.03)]
                 border border-[rgba(255,255,255,0.08)] rounded-md text-slate-200 
                 focus:outline-none focus:ring-2 focus:ring-primary2 transition">
      </div>

      <!-- Email -->
      <div>
        <label class="text-sm text-slate-300">
          Email <span class="text-rose-500">*</span>
        </label>
        <input type="email" name="email" required
          class="w-full mt-1 px-3 py-2 bg-[rgba(255,255,255,0.03)]
                 border border-[rgba(255,255,255,0.08)] rounded-md text-slate-200 
                 focus:outline-none focus:ring-2 focus:ring-primary2 transition">
      </div>

      <!-- Password -->
      <div>
        <label class="text-sm text-slate-300">
          Password <span class="text-rose-500">*</span>
        </label>
        <div class="relative">
          <input type="password" name="password" id="password" required minlength="6"
            class="w-full mt-1 px-3 py-2 pr-10 bg-[rgba(255,255,255,0.03)]
                   border border-[rgba(255,255,255,0.08)] rounded-md text-slate-200 
                   focus:outline-none focus:ring-2 focus:ring-primary2 transition">
          <i class="fa-solid fa-eye absolute right-3 top-3 text-slate-400 cursor-pointer hover:text-indigo-400 transition"
             onclick="togglePassword('password', this)"></i>
        </div>

        <!-- Password Strength Bar -->
        <div class="mt-2 h-2 w-full bg-slate-800 rounded-full overflow-hidden">
          <div id="strength-bar" class="h-full w-0 transition-all duration-300 rounded-full"></div>
        </div>
        <p id="strength-text" class="text-xs text-slate-400 mt-1"></p>
      </div>

      <!-- Confirm Password -->
      <div>
        <label class="text-sm text-slate-300">
          Confirm Password <span class="text-rose-500">*</span>
        </label>
        <div class="relative">
          <input type="password" id="confirm_password" name="confirm_password" required minlength="6"
            class="w-full mt-1 px-3 py-2 pr-10 bg-[rgba(255,255,255,0.03)]
                   border border-[rgba(255,255,255,0.08)] rounded-md text-slate-200 
                   focus:outline-none focus:ring-2 focus:ring-primary2 transition">
          <i class="fa-solid fa-eye absolute right-3 top-3 text-slate-400 cursor-pointer hover:text-indigo-400 transition"
             onclick="togglePassword('confirm_password', this)"></i>
        </div>
        <p id="match-text" class="text-xs mt-1"></p>
      </div>

      <!-- Department Dropdown -->
      <div x-data="{ open: false, selected: 'Select Department' }" class="relative">
        <label class="text-sm text-slate-300">
          Department <span class="text-rose-500">*</span>
        </label>

        <!-- Dropdown trigger -->
        <button type="button" 
                @click="open = !open" 
                class="w-full mt-1 flex justify-between items-center px-3 py-2 
                       bg-[rgba(255,255,255,0.03)] border border-[rgba(255,255,255,0.08)] 
                       rounded-md text-slate-200 focus:outline-none focus:ring-2 
                       focus:ring-primary2 transition cursor-pointer">
          <span x-text="selected"></span>
          <i class="fa-solid fa-chevron-down text-slate-400 ml-2"></i>
        </button>

        <!-- Dropdown options -->
        <div x-show="open" @click.away="open = false" 
             x-transition
             class="absolute z-50 mt-1 w-full rounded-md bg-[#0b1f2d]/95 
                    border border-[rgba(255,255,255,0.08)] shadow-glow overflow-hidden">
          <template x-for="option in ['IT', 'HR', 'Finance', 'Marketing', 'Operations']" :key="option">
            <div @click="selected = option; open = false; $refs.department.value = option"
                 class="px-3 py-2 text-slate-200 hover:bg-[rgba(139,92,246,0.15)] 
                        hover:text-white cursor-pointer transition">
              <span x-text="option"></span>
            </div>
          </template>
        </div>

        <!-- Hidden select (for form submission) -->
        <select x-ref="department" name="department" required class="hidden">
          <option value="" disabled selected>Select Department</option>
          <option value="IT">IT</option>
          <option value="HR">HR</option>
          <option value="Finance">Finance</option>
          <option value="Marketing">Marketing</option>
          <option value="Operations">Operations</option>
        </select>
      </div>

      <!-- Hidden Role -->
      <input type="hidden" name="role" value="Employee">

      <!-- Register Button -->
      <button type="submit"
        class="w-full py-2 rounded-md bg-gradient-to-r from-primary1 to-primary2 
               text-white font-semibold shadow-glow 
               hover:shadow-[0_0_25px_rgba(139,92,246,0.4)] 
               transition-all duration-300">
        Register as Employee
      </button>

      <!-- Login Redirect -->
      <div class="text-center text-sm text-slate-400">
        Already have an account?
        <a href="{{ url_for('login') }}" 
           class="underline text-indigo-300 hover:text-indigo-400">Login</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}

<!-- Fix email field turning white -->
<style>
  /* Fix Chrome autofill background */
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus {
    -webkit-box-shadow: 0 0 0 1000px rgba(255,255,255,0.03) inset !important;
    -webkit-text-fill-color: #cbd5e1 !important;
    transition: background-color 9999s ease-in-out 0s !important;
  }

  /* Force same background for all inputs */
  input[type="email"],
  input[type="text"],
  input[type="password"] {
    background-color: rgba(255,255,255,0.03) !important;
    color: #cbd5e1 !important;
  }
</style>

<script>
  //  Toggle Password Visibility
  function togglePassword(fieldId, icon) {
    const input = document.getElementById(fieldId);
    if (input.type === "password") {
      input.type = "text";
      icon.classList.replace("fa-eye", "fa-eye-slash");
    } else {
      input.type = "password";
      icon.classList.replace("fa-eye-slash", "fa-eye");
    }
  }

  //  Password Strength Indicator
  const password = document.getElementById("password");
  const strengthBar = document.getElementById("strength-bar");
  const strengthText = document.getElementById("strength-text");

  password.addEventListener("input", () => {
    const val = password.value;
    let strength = 0;

    if (val.length >= 6) strength++;
    if (/[A-Z]/.test(val)) strength++;
    if (/[0-9]/.test(val)) strength++;
    if (/[^A-Za-z0-9]/.test(val)) strength++;

    const colors = ["#ef4444", "#f59e0b", "#10b981"];
    const texts = ["Weak", "Medium", "Strong"];
    const widths = ["25%", "60%", "100%"];

    if (val.length === 0) {
      strengthBar.style.width = "0";
      strengthText.textContent = "";
    } else {
      const idx = Math.min(strength - 1, 2);
      strengthBar.style.width = widths[idx];
      strengthBar.style.backgroundColor = colors[idx];
      strengthText.textContent = texts[idx];
      strengthText.style.color = colors[idx];
    }
  });

  //  Confirm Password Match Check
const confirm = document.getElementById("confirm_password");
const matchText = document.getElementById("match-text");

function checkMatch() {
  if (confirm.value.length === 0) {
    matchText.textContent = "";
    matchText.style.color = "";
    return;
  }

  if (confirm.value === password.value) {
    matchText.textContent = "Password match";
    matchText.style.color = "#10b981";  // green
  } else {
    matchText.textContent = "Password do not match";
    matchText.style.color = "#ef4444";  // red
  }
}

password.addEventListener("input", checkMatch);
confirm.addEventListener("input", checkMatch);

</script>

{% endblock %}

